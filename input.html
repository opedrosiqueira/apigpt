<h1 id="carregando-dados-no-sveltekit">Carregando Dados do Servidor</h1>
<p>Antes que um componente <code>+page.svelte</code> (e seus componentes <code>+layout.svelte</code>) possa ser exibido no navegador, muitas vezes √© necess√°rio obter dados do servidor. Isso √© feito por meio das fun√ß√µes <code>load</code>.</p>

<h2 id="dados-da-p√°gina">Dados da P√°gina</h2>

<p>Um arquivo <code>+page.svelte</code> pode ter um arquivo irm√£o chamado <code>+page.server.js</code>, que √© executado no servidor antes da p√°gina ser carregada no cliente. Esse arquivo exporta uma fun√ß√£o <code>load</code>, cujo retorno ser√° acessado na p√°gina por meio da propriedade <code>data</code>.</p>

<p>Crie o arquivo <code ctc>src/routes/03/dados/+page.server.js</code>:</p>

<pre><code class="language-javascript">export function load() {
  return {
    post: { title: 'T√≠tulo de Exemplo', content: 'Conte√∫do &lt;b&gt;supimpa&lt;/b&gt; de Exemplo' },
    author: { name: 'Autor Exemplo', email: 'autor@exemplo.com' }
  };
}</code></pre>

<p>Crie o arquivo <code ctc>src/routes/03/dados/+page.svelte</code>:</p>

<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;h1&gt;{data.post.title}&lt;/h1&gt;
&lt;sub&gt;por {data.author.name}&lt;/sub&gt;
&lt;div&gt;{@html data.post.content}&lt;/div&gt;</code></pre>

<p><strong>Explica√ß√£o:</strong> A fun√ß√£o <code>load</code> √© chamada no servidor e retorna um objeto contendo os dados necess√°rios para a p√°gina. Esses dados ficam dispon√≠veis no componente por meio da propriedade <code>data</code>.</p>

<p><img id="server-load" alt="servidor carrega dados para a p√°gina"></p>

<h2 id="load-params">Par√¢metros da Fun√ß√£o <code>load</code></h2>

<p>A fun√ß√£o <code>load</code> recebe um objeto <a target="_blank" href="https://svelte.dev/docs/kit/@sveltejs-kit#ServerLoadEvent" id="serverloadevent"><code>ServerLoadEvent</code></a>, que cont√©m informa√ß√µes √∫teis sobre a requisi√ß√£o, como <code>params</code>, <code>url</code> e <code>fetch</code>. Essas informa√ß√µes permitem acessar par√¢metros da URL, fazer requisi√ß√µes, entre outros.</p>

<p>Voc√™ pode inspecionar o conte√∫do desse objeto modificando o arquivo <code>+page.server.js</code>:</p>

<pre><code class="language-javascript">export function load(event) {
  console.log(event);
  return {
    post: { title: 'T√≠tulo de Exemplo', content: 'Conte√∫do <b>supimpa</b> de Exemplo' },
    author: { name: 'Autor Exemplo', email: 'autor@exemplo.com' }
  };
}</code></pre>

<p><strong>Explica√ß√£o:</strong> Esse c√≥digo imprime no terminal do servidor as informa√ß√µes presentes no objeto <code>event</code>, que representa a requisi√ß√£o da p√°gina. Experimente acessar essa rota, e verifique no terminal as informa√ß√µes registradas.</p>

<h2>Anatomia de uma URL</h2>

<pre>    https://meusite.com/uma/pagina?p1=123&p2=oi
    11111   22222222222 3333333333 444444444444
protocolo   dom√≠nio     rota       consulta</pre>

<ul>
  <li>A rota (<em>route</em>) tamb√©m √© conhecida como caminho (<em>path</em>).</li>
  <li>A consulta (<em>query</em>) tamb√©m √© conhecida como busca (<em>search</em>) ou <em>query string</em>.</li>
  <li>Exemplo de uma URL real:
    <pre class="text-center"><a target="_blank" href="https://www.youtube.com/watch?v=TiT7TlAWDEs&list=PLcZDQl73nB1ACZdEAd_wNbY0tB_QutcH3&index=2&t=360s&ab_channel=PedroHenriquedeAraujoSiqueira">
https://www.youtube.com/watch
?v=TiT7TlAWDEs
&list=PLcZDQl73nB1ACZdEAd_wNbY0tB_QutcH3
&index=2
&t=360s
&ab_channel=PedroHenriquedeAraujoSiqueira</a></pre>
  </li>
</ul>

<h2 id="params">Par√¢metros de Rota</h2>

<p>As rotas em SvelteKit podem ser est√°ticas, como <code>src/routes/about</code>, ou din√¢micas, como <code>src/routes/blog/[slug]</code> ou <code>src/routes/posts/[ano]/[mes]</code>. As pastas entre colchetes representam <strong>par√¢metros de rota</strong>, que s√£o vari√°veis extra√≠das da URL mas que levam √† mesma p√°gina.</p>

<p>Exemplos:</p>
<ul>
  <li><code>/about</code> acessa a p√°gina em <code>src/routes/about</code>.</li>
  <li><code>/blog/post1</code> e <code>/blog/post2</code> acessam <code>src/routes/blog/[slug]</code>, sendo <code>post1</code> e <code>post2</code> os valores de <code>[slug]</code>.</li>
  <li><code>/posts/2025/03</code> e <code>/posts/2024/11</code> acessam <code>src/routes/posts/[ano]/[mes]</code>, sendo <code>2025</code> e <code>2024</code> os valores de <code>[ano]</code> e <code>03</code> e <code>11</code> os valores de <code>[mes]</code>.</li>
</ul>

<h4>Exerc√≠cio de Fixa√ß√£o</h4>
<ol>
  <li>Ligue as URLs da esquerda √†s rotas da direita:
    <pre>https://meusite.com/blog ------------ (a)
https://meusite.com/sobre ----------- (b)
https://meusite.com/blog/[slug] ----- (c)
https://meusite.com/blog/artigo ----- (d)          (1) src/routes/about
https://meusite.com/slug ------------ (e)          (2) src/routes/blog
https://meusite.com/blog/2025/03 ---- (f)          (3) src/routes/blog/[slug]
https://meusite.com/2025/03 --------- (g)          (4) src/routes/blog/[ano]/[mes]
https://meusite.com/blog/2025 ------- (h)          (5) "erro 404"
https://meusite.com/blog/outro/artigo (i)
https://meusite.com/blog/about ------ (j)
https://meusite.com/blog/2025/03/01 - (k)</pre>
  </li>
</ol>

<p>Dentro da fun√ß√£o <code>load</code>, os valores dos par√¢metros de rota podem ser acessados via <code>event.params</code>.</p>

<p>Crie o arquivo <code ctc>src/routes/03/[rota]/[dinamica]/+page.server.js</code>:</p>
<pre><code class='js'>export function load(event) {
  const parametro1 = event.params.rota;
  const parametro2 = event.params.dinamica;

return { parametro1, parametro2 };
}</code></pre>

<p>Crie o arquivo <code ctc>src/routes/03/[rota]/[dinamica]/+page.svelte</code>:</p>

<pre><code class="svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;p&gt;O primeiro par√¢metro da rota √© {data.parametro1}.&lt;/p&gt;
&lt;p&gt;O segundo par√¢metro da rota √© {data.parametro2}.&lt;/p&gt;</code></pre>

<p><strong>Explica√ß√£o:</strong></p>
<ul>
  <li>Pastas entre colchetes (como <code>[rota]</code> e <code>[dinamica]</code>) representam par√¢metros de rota, que s√£o vari√°veis extra√≠das da URL. Isso permite que diferentes URLs acessem a mesma estrutura de rota.</li>
  <li>Os valores dessas vari√°veis s√£o automaticamente extra√≠dos da URL e disponibilizados como propriedades do objeto <code>event.params</code>, onde os nomes devem coincidir com os nomes das pastas.</li>
  <li>O objeto retornado pela fun√ß√£o <code>load</code> fica dispon√≠vel no componente <code>+page.svelte</code> atrav√©s da propriedade <code>data</code>.</li>
</ul>

<div class="info">
  <p><strong>Observa√ß√£o:</strong> √â comum usar <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">desestrutura√ß√£o</a> para extrair apenas as partes desejadas de um objeto passado como argumento a uma fun√ß√£o. Isso torna o c√≥digo mais limpo e direto.</p>
  <p>Por exemplo, o arquivo <code>src/03/[rota]/[dinamica]/+page.server.js</code> poderia ficar assim:</p>

  <pre><code class="js">export function load({ params }) {
  const parametro1 = params.rota;
  const parametro2 = params.dinamica;

  return { parametro1, parametro2 };
}</code></pre>

  <p>No exemplo acima, desestruturamos apenas a propriedade <code>params</code> do objeto <code>event</code> recebido pela fun√ß√£o <code>load</code>, j√° que as demais propriedades n√£o s√£o necess√°rias neste caso.</p>
</div>

<h2 id="url">Par√¢metros de Consulta</h2>

<p>Al√©m dos <strong>par√¢metros de rota</strong>, tamb√©m podemos passar informa√ß√µes pela <strong>URL</strong> usando os chamados <strong>par√¢metros de consulta</strong> ‚Äî tamb√©m conhecidos como <strong>query strings</strong> ou <strong>search params</strong>. Esses par√¢metros aparecem ap√≥s o s√≠mbolo <code>?</code> na URL. Por exemplo:</p>

<pre><code>https://meusite.com/produtos?categoria=livros&amp;ordem=preco</code></pre>

<p>Nesse caso, a URL possui dois par√¢metros de consulta:</p>
<ul>
  <li><code>categoria</code> com valor <code>livros</code></li>
  <li><code>ordem</code> com valor <code>preco</code></li>
</ul>

<p>No SvelteKit, dentro da fun√ß√£o <code>load</code>, voc√™ pode acessar esses dados atrav√©s da propriedade <code>url</code>, que √© um objeto <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/URL">URL</a>.</p>

<p>Esse objeto representa a URL da requisi√ß√£o e fornece v√°rias informa√ß√µes √∫teis, como:</p>
<ul>
  <li><code>origin</code>: origem da URL (ex: <code>https://meusite.com</code>)</li>
  <li><code>pathname</code>: caminho da URL (ex: <code>/produtos</code>)</li>
  <li><code>searchParams</code>: um objeto <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams">URLSearchParams</a> que permite acessar os par√¢metros de consulta facilmente.</li>
</ul>

<p>Crie o arquivo <code ctc>src/routes/03/formulario-recebendo/+page.server.js</code>:</p>

<pre><code class="language-js">export function load({ url }) {
  console.log(url);

  const fruta = url.searchParams.get('fruta');
  const legume = url.searchParams.get('legume');

  return { fruta, legume };
}</code></pre>

<div class="info">
  <p>üí° <strong>Dica:</strong> Aqui usamos <code>console.log()</code> para inspecionar o conte√∫do da URL no terminal. Essa pr√°tica √© muito √∫til para <strong>debugar</strong>: investigar e entender o que est√° acontecendo no seu c√≥digo.</p>
  <p>Quando estiver em d√∫vida sobre o valor de uma vari√°vel <code>x</code>, utilize <code>console.log(x)</code> para verificar seu conte√∫do. Isso pode ajudar bastante na hora de identificar problemas e entender melhor o fluxo do programa.</p>
</div>

<p>Crie o arquivo <code ctc>src/routes/03/formulario-recebendo/+page.svelte</code>:</p>

<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

{#if data.fruta &amp;&amp; data.legume}
  Voc√™ gosta da fruta {data.fruta} e do legume {data.legume}
{:else}
  Informe uma fruta e um legume...
{/if}

&lt;p&gt;&lt;a href="/03/formulario-enviando"&gt;Voltar ao formul√°rio&lt;/a&gt;&lt;/p&gt;
</code></pre>

<p><strong>Explica√ß√£o:</strong></p>
<ul>
  <li>A fun√ß√£o <code>load</code> extrai os par√¢metros de consulta da URL usando <code>url.searchParams.get</code>.</li>
  <li>Os valores obtidos s√£o retornados √† p√°gina.</li>
  <li>A p√°gina exibe os dados recebidos ou solicita que o usu√°rio informe-os, dependendo se os par√¢metros de consulta foram informados ou n√£o.</li>
</ul>
<p>Experimente acessar a url <code>/03/formulario-recebendo</code> no navegador, com e sem os par√¢metros de consulta corretos, para ver os resultados!</p>

<h4>Exerc√≠cios de Fixa√ß√£o</h4>
<ol>
  <li>Considere os seguintes arquivos:
    <p><code>src/routes/03/[p1]/[p2]/+page.server.js</code>:</p>
    <pre><code class="language-js">export function load({ params, url }) {
  const rp1 = params.p1;
  const rp2 = params.p2;
  const sp1 = url.searchParams.get('p1');
  const sp2 = url.searchParams.get('p2');

  return { rp1, rp2, sp1, sp2 };
}</code></pre>
    <p><code>src/routes/03/[p1]/[p2]/+page.svelte</code>:</p>
    <pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;p&gt;Par√¢metros de rota:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;{data.rp1}&lt;/li&gt;&lt;li&gt;{data.rp2}&lt;/li&gt;&lt;/ul&gt;

&lt;p&gt;Par√¢metros de busca:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;{data.sp1}&lt;/li&gt;&lt;li&gt;{data.sp2}&lt;/li&gt;&lt;/ul&gt;
</code></pre>
    <p>O que aparece na tela para cada uma das seguintes URLs?</p>
    <ol type="a">
      <li>https://meusite.com/03/uma/pagina?p1=123&amp;q4=567</li>
      <li>https://meusite.com/03/uma/pagina?p1=123&amp;p2=oi</li>
      <li>https://meusite.com/03/123/oi?p1=uma&amp;p2=pagina</li>
      <li>https://meusite.com/03/uma/pagina?z8=123&amp;p2=567</li>
      <li>https://meusite.com/03/umapagina?p1=123&amp;p2=oi</li>
      <li>https://meusite.com/03/outra/url?p1=td_blz&amp;p2=ok</li>
      <li>https://meusite.com/03/uma/pagina</li>
      <li>https://meusite.com/03/uma/outra/pagina</li>
      <li>https://meusite.com/03/p1/123?p2=567</li>
      <li>https://meusite.com/03/p1/uma/pagina?p1=123&amp;p2=oi</li>
    </ol>
  </li>
  <p><strong>Dicas:</strong></p>
  <ul>
    <li>Par√¢metros de rota s√£o obrigat√≥rios: se n√£o corresponderem √† estrutura da URL esperada, ocorre erro 404.</li>
    <li>Par√¢metros de consulta s√£o opcionais: se n√£o estiverem presentes, o valor retornado por <code>url.searchParams.get()</code> ser√° <code>null</code>, que n√£o √© exibido na tela.</li>
  </ul>
  <li>Considere os seguintes arquivos:
    <p><code>src/routes/a/[b]/c/+page.server.js</code>:</p>
    <pre><code class="language-js">export function load({ params, url }) {
  const b = params.b;
  const d = url.searchParams.get('d');
  const e = url.searchParams.get('e');

  return { b, d, e };
}</code></pre>
    <p><code>src/routes/a/[b]/c/+page.svelte</code>:</p>
    <pre><code>&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;
{data.b} {data.d} {data.e}</code></pre>
    <p>D√™ exemplos de URLs que poderiam ser usadas para acessar essa rota. Para cada URL, explique o que apareceria na tela do navegador.</p>
  </li>
  <li>Considere os seguintes arquivos:
    <p><code>src/routes/a/[b]/[c]/+page.server.js</code>:</p>
    <pre><code class="js">export function load({ params, url }) {
    const x = params.b;
    const y = params.c;
    const z = url.searchParams.get('d');

    return { x, y, z };
}</code></pre>
    <p><code>src/routes/a/[b]/[c]/+page.svelte</code>:</p>
    <pre><code>&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;
{data.x} {data.y} {data.z}</code></pre>
    <p>D√™ exemplos de URLs que poderiam ser usadas para acessar essa rota. Para cada URL, explique o que apareceria na tela do navegador.</p>
  </li>
  <li>Considere os seguintes arquivos:
    <p><code>src/routes/[a]/b/[c]/+page.server.js</code>:</p>
    <pre><code class="js">export function load({ params, url }) {
    const w = params.a;
    const x = params.c;
    const y = url.searchParams.get('d');
    const z = url.searchParams.get('e');

    return { w, x, y, z };
}</code></pre>
    <p><code>src/routes/[a]/b/[c]/+page.svelte</code>:</p>
    <pre><code>&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;
{data.w} {data.x} {data.y} {data.z}</code></pre>
    <p>D√™ exemplos de URLs que poderiam ser usadas para acessar essa rota. Para cada URL, explique o que apareceria na tela do navegador.</p>
  </li>
</ol>

<h3>Enviando Dados via Formul√°rio</h3>

<p>Voc√™ pode acessar uma p√°gina digitando sua URL no navegador ou clicando em um link. Da mesma forma, par√¢metros de consulta podem ser informados manualmente na URL ou enviados via formul√°rio.</p>

<p>Crie o arquivo <code ctc>src/routes/03/formulario-enviando/+page.svelte</code>:</p>

<pre><code class="language-svelte">&lt;form action="/03/formulario-recebendo"&gt;
  &lt;input name="fruta" placeholder="Qual tua fruta preferida?" /&gt;
  &lt;input name="legume" placeholder="E legume?" /&gt;
  &lt;button&gt;Enviar&lt;/button&gt;
&lt;/form&gt;

&lt;p&gt;&lt;a href="/03/formulario-recebendo"&gt;Ir&lt;/a&gt;&lt;/p&gt;</code></pre>

<p><strong>Explica√ß√£o:</strong></p>
<ul>
  <li>Tanto o atributo <code>action</code> do elemento <code>&lt;form&gt;</code>, quanto o atributo <code>href</code> do elemento <code>&lt;a&gt;</code>, redirecionam para a rota <code>/03/formulario-recebendo</code>.</li>
  <li>Contudo, o <code>&lt;form&gt;</code> tamb√©m envia dados para essa rota.</li>
  <li>Esses dados devem vir de campos de entrada, como <code>input</code>, <code>textarea</code> ou <code>select</code>, que precisam ter um atributo <code>name</code> definido.</li>
  <li>Por padr√£o, os dados de um <code>&lt;form&gt;</code> s√£o enviados via URL como par√¢metros de consulta ‚Äî por exemplo: <code>?fruta=banana&amp;legume=cenoura</code>.</li>
  <li>No lado do servidor, esses dados podem ser acessados na fun√ß√£o <code>load</code> por meio de <code>url.searchParams.get()</code>.</li>
</ul>